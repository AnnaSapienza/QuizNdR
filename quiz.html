<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Caccia alle Fake News</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Anton&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Helvetica Neue', sans-serif;
            background-color: #1a1a1a;
            color: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 1rem 0;
        }

        #main-container {
            background-color: #d90429; /* Bright red from poster */
            padding: 2rem;
            border: 4px solid #ffc300; /* Yellow from poster */
            width: 90%;
            max-width: 600px;
            text-align: center;
        }

        #description-container h2, #results-container h2 {
            font-family: 'Anton', sans-serif;
            font-size: 3rem;
            color: #ffc300;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 1rem;
            -webkit-text-stroke: 1px black;
        }

        #description-container p {
            font-size: 1.2rem;
            line-height: 1.6;
            margin-bottom: 2rem;
            color: #fff;
        }

        #start-btn {
            font-family: 'Anton', sans-serif;
            background-color: #ffc300;
            color: #000;
            border: 2px solid #000;
            border-radius: 0;
            padding: 0.8rem 2rem;
            font-size: 1.5rem;
            text-transform: uppercase;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.2s;
        }

        #start-btn:hover {
            background-color: #fff;
            transform: scale(1.05);
        }

        #question-label {
            font-family: 'Anton', sans-serif;
            font-size: 1.5rem;
            font-weight: bold;
            color: #ffc300;
            margin-bottom: 1rem;
            text-transform: uppercase;
        }

        #question-text {
            font-size: 1.4rem;
            margin-bottom: 2rem;
            min-height: 60px;
        }

        .answer-btn {
            font-family: 'Anton', sans-serif;
            background-color: #000;
            color: #ffc300;
            border: 2px solid #ffc300;
            border-radius: 0;
            padding: 0.8rem 1.5rem;
            font-size: 1.2rem;
            cursor: pointer;
            margin: 0 0.5rem;
            transition: background-color 0.2s, color 0.2s;
            text-transform: uppercase;
        }

        .answer-btn:hover {
            background-color: #ffc300;
            color: #000;
        }

        .answer-btn.selected {
            background-color: #ffc300;
            color: #000;
            transform: scale(1.1);
        }

        #nav-container {
            margin-top: 2rem;
        }
        
        #next-btn, #download-btn {
             font-family: 'Anton', sans-serif;
            background-color: #ffc300;
            color: #000;
            border: 2px solid #000;
            border-radius: 0;
            padding: 0.8rem 2rem;
            font-size: 1.2rem;
            text-transform: uppercase;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.2s;
        }

        #next-btn:disabled {
            background-color: #a37f00;
            color: #555;
            cursor: not-allowed;
            transform: none;
        }

        #next-btn:hover:not(:disabled), #download-btn:hover {
            background-color: #fff;
            transform: scale(1.05);
        }

        #results-container {
            display: none;
        }
        
        #score-text {
            font-family: 'Anton', sans-serif; /* Added font */
            font-size: 3rem; /* Made bigger */
            color: #ffc300; /* Yellow color */
            font-weight: bold;
            margin-top: 2rem; /* Added spacing */
            margin-bottom: 1rem;
            text-transform: uppercase; /* Uppercase */
            -webkit-text-stroke: 1px black; /* Outline */
        }
        
        #feedback-text {
            display: none; /* Hidden as requested */
        }
        
        #feedback-image {
            display: none; /* Hidden by default, shown by JS */
            max-width: 250px; /* Increased size */
            height: auto;
            margin: 1rem auto 2rem auto;
        }

    </style>
</head>
<body>

    <div id="main-container">
        <div id="description-container">
            <h2>Caccia alle Fake News!</h2>
            <p>Sei pronto a diventare un algoritmo? Metti alla prova il tuo "sesto senso" e scopri se riesci a riconoscere la verità dalle bugie!</p>
            <button id="start-btn">Inizia il Quiz</button>
        </div>

        <div id="quiz-container" style="display: none;">
            <div id="question-label">Domanda 1</div>
            <p id="question-text">Testo della domanda...</p>
            <div id="answer-buttons">
                <button class="answer-btn" onclick="selectAnswer(true)">Vero</button>
                <button class="answer-btn" onclick="selectAnswer(false)">Falso</button>
            </div>
            <div id="nav-container">
                <button id="next-btn" disabled>Prossimo</button>
            </div>
        </div>

        <div id="results-container">
            <h2>Punteggio Finale</h2>
            <p id="score-text"></p>
            <p id="feedback-text"></p>
            <img id="feedback-image" src="" alt="Immagine di feedback">
            <button id="download-btn">Scarica Riepilogo</button>
        </div>
    </div>

    <!-- jsPDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <!-- Base64 images -->
    <script src="images.js"></script>

    <script>
        const quizData = [
            { label: "News 1", question: "Il metodo più pratico per separare il tuorlo dall'albume.", answer: true },
            { label: "News 2", question: "Clima stabile da oltre due secoli.", answer: false },
            { label: "News 3", question: "Un animale alieno mangia l'aglio.", answer: false },
            { label: "News 4", question: "I motori a fulmini del futuro.", answer: true },
            { label: "News 5", question: "I raggi cosmici ci attraverseranno questa sera.", answer: true },
            { label: "News 6", question: "Perossido di idrogeno nel miele.", answer: true },
            { label: "News 7", question: "Il trucchetto della nonna per padelle sempre splendenti.", answer: false }
        ];

        let currentQuestionIndex = 0;
        let score = 0;
        let userAnswer = null;
        const userAnswersLog = [];

        // Elementi DOM
        const descriptionContainer = document.getElementById('description-container');
        const startBtn = document.getElementById('start-btn');
        const quizContainer = document.getElementById('quiz-container');
        const resultsContainer = document.getElementById('results-container');
        const questionLabelEl = document.getElementById('question-label');
        const questionTextEl = document.getElementById('question-text');
        const answerButtons = document.querySelectorAll('.answer-btn');
        const nextBtn = document.getElementById('next-btn');
        const scoreTextEl = document.getElementById('score-text');
        const feedbackTextEl = document.getElementById('feedback-text');
        const feedbackImageEl = document.getElementById('feedback-image');
        const downloadBtn = document.getElementById('download-btn');

        function startQuiz() {
            descriptionContainer.style.display = 'none';
            quizContainer.style.display = 'block';
            loadQuestion();
        }

        function loadQuestion() {
            userAnswer = null;
            answerButtons.forEach(btn => btn.classList.remove('selected'));
            const currentQuestion = quizData[currentQuestionIndex];
            questionLabelEl.textContent = currentQuestion.label;
            questionTextEl.textContent = currentQuestion.question;
            nextBtn.disabled = true;
        }

        function selectAnswer(answer) {
            userAnswer = answer;
            answerButtons.forEach(btn => btn.classList.remove('selected'));
            const selectedButton = (answer) ? answerButtons[0] : answerButtons[1];
            selectedButton.classList.add('selected');
            nextBtn.disabled = false;
        }

        function handleNext() {
            if (userAnswer === quizData[currentQuestionIndex].answer) {
                score++;
            }
            userAnswersLog.push({
                label: quizData[currentQuestionIndex].label,
                question: quizData[currentQuestionIndex].question,
                userAnswer: userAnswer
            });
            currentQuestionIndex++;
            if (currentQuestionIndex < quizData.length) {
                loadQuestion();
            } else {
                showResults();
            }
        }

        function showResults() {
            quizContainer.style.display = 'none';
            resultsContainer.style.display = 'block';
            scoreTextEl.textContent = `${score} su ${quizData.length}`;
            let feedback;
            let imageUrl;

            if (score <= 2) { 
                feedback = "Algoritmo Principiante"; 
                imageUrl = feedbackImages.training; 
            } else if (score <= 5) { 
                feedback = "Algoritmo Attento"; 
                imageUrl = feedbackImages.attento; 
            } else { 
                feedback = "Algoritmo Esperto"; 
                imageUrl = feedbackImages.esperto; 
            }
            feedbackTextEl.textContent = feedback;
            feedbackImageEl.src = imageUrl;
            feedbackImageEl.style.display = 'block';
        }

        function downloadResults() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            const pageWidth = doc.internal.pageSize.getWidth();
            const pageHeight = doc.internal.pageSize.getHeight();
            const margin = 15;
            let y = margin + 60;

            doc.addImage(feedbackImages.background, 'PNG', 0, 0, pageWidth, pageHeight);

            // Then draw all text and images on top

            doc.setFont("helvetica", "bold");
            // doc.setFontSize(24);
            // doc.setTextColor(217, 4, 41);
            // doc.text('CACCIA ALLE FAKE NEWS', pageWidth/2, y, { align: "center" });

            doc.setFontSize(18);
            doc.setTextColor(0,0,0);
            doc.text(`PUNTEGGIO FINALE: ${score} / ${quizData.length}`, pageWidth/2, y, { align: "center" });
            y += 2;

            if (feedbackImageEl && feedbackImageEl.src) {
                const imgData = feedbackImageEl.src;
                const imgHeight = 80;
                const imgWidth = 80* 787 / 1024;
                const x = (pageWidth - imgWidth)/2;
                let yPos = y + 5;
                if (yPos + imgHeight > pageHeight - margin) {
                    doc.addPage();
                    yPos = margin;
                }
                doc.addImage(imgData, 'PNG', x, yPos, imgWidth, imgHeight);
            }

            y += 95;

            // doc.text(`FEEDBACK: ${feedbackTextEl.textContent}`, margin, y);
            // y += 15;

            // doc.setDrawColor(250, 217, 16);
            // doc.setLineWidth(2);
            // doc.line(margin, y, pageWidth-margin, y);
            // y += 10;

            doc.setFontSize(12);
            const lineSpacing = 4;

            userAnswersLog.forEach((log) => {
                const userAnswerText = log.userAnswer ? 'Vero' : 'Falso';
                
                // Split the question text so it fits the page width
                const questionLines = doc.splitTextToSize(log.question, pageWidth - 2*margin);
                
                // If not enough space, add a new page
                if (y + (questionLines.length + 1)*lineSpacing > pageHeight - margin) {
                    doc.addPage();
                    y = margin;
                }
                
                // Draw the label in bold red
                doc.setFont("helvetica", "bold");
                doc.setTextColor(217, 4, 41); // red used in your quiz
                doc.text(`${log.label}:`, margin+30, y);
                
                const labelWidth = doc.getTextWidth(`${log.label}: `);
                
                // Draw the question in normal black next to label (or below)
                doc.setFont("helvetica", "normal");
                doc.setTextColor(0,0,0);
                doc.text(questionLines, margin+30+labelWidth, y);
                
                // Draw user's answer in yellow below question
                doc.setFont("helvetica", "normal");
                //doc.setTextColor(250, 217, 16); // yellow from quiz
                //doc.text(`- La tua risposta: ${userAnswerText}`, margin, y + 5);

                doc.text("- La tua risposta: ", margin+30, y + 5);

                // Bold text for the answer
                doc.setFont("helvetica", "bold");
                doc.text(`${userAnswerText}`, margin +30+ doc.getTextWidth("- La tua risposta: "), y + 5);

                
                // Update y position for next entry
                y += (questionLines.length + 1)*lineSpacing + 5;
            });

            // doc.setFont("helvetica", "normal");
            // doc.setFontSize(12);
            // userAnswersLog.forEach((log) => {
            //     const userAnswerText = log.userAnswer ? 'Vero' : 'Falso';
            //     const entry = `${log.label}: ${log.question}\n - La tua risposta: ${userAnswerText}`;
            //     const splitText = doc.splitTextToSize(entry, pageWidth - 2*margin);
            //     if (y + splitText.length*7 > pageHeight - margin) {
            //         doc.addPage();
            //         y = margin;
            //     }
            //     doc.text(splitText, margin, y);
            //     y += splitText.length*7 + 5;
            // });

            doc.save('riepilogo_quiz.pdf');
        }

        startBtn.addEventListener('click', startQuiz);
        nextBtn.addEventListener('click', handleNext);
        downloadBtn.addEventListener('click', downloadResults);
        </script>
</body>
</html>
